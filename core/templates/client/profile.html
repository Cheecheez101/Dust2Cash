<!doctype html>
{% extends 'base.html' %}
{% load static %}

{% block title %}Complete Your Profile Â· Dust2Cash{% endblock %}
{% block body_class %}dashboard-body{% endblock %}

{% block content %}
<nav class="navbar dashboard-nav bg-white shadow-sm">
  <div class="nav-inner container">
    <a class="nav-identity" href="/">
      <img src="{% static 'img/dust2cashlogo.png' %}" alt="Dust2Cash logo">
      <div>
        <strong>Dust2Cash</strong>
        <div class="text-muted small">Client workspace</div>
      </div>
    </a>
    <div class="nav-actions">
      <span class="status-pill info">Active</span>
      <a class="nav-pill nav-pill--ghost" href="{% url 'client_dashboard' %}">Dashboard</a>
      <a class="nav-pill nav-pill--ghost" href="{% url 'client_profile' %}">Profile</a>
      <a class="nav-pill nav-pill--ghost" href="{% url 'change_password' %}">Password</a>
      <a class="nav-pill nav-pill--danger" href="{% url 'logout' %}">Logout</a>
    </div>
  </div>
</nav>

<main class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm border-0">
        <div class="card-body p-5">
          <h2 class="mb-3">Complete Your Profile</h2>
          <p class="text-muted mb-4">All fields are required to start making transactions.</p>

          {% if account_verification %}
          <div class="alert alert-light border mb-4">
            <div class="d-flex justify-content-between flex-wrap gap-2">
              <div>
                <strong>Verification progress</strong>
                <div class="small text-muted">{{ account_verification.completion_score }}% complete</div>
              </div>
              <div class="small text-end">
                Phone: {% if account_verification.phone_verified %}<span class="text-success">Verified</span>{% else %}<span class="text-warning">Pending</span>{% endif %}<br>
                ID: {% if account_verification.id_uploaded %}<span class="text-success">Uploaded</span>{% else %}<span class="text-warning">Pending</span>{% endif %}
              </div>
            </div>
            <div class="mt-3 d-flex gap-2">
              {% if not account_verification.phone_verified %}
              <a href="{% url 'request_otp' %}" class="btn btn-sm btn-primary">Verify Phone</a>
              {% endif %}
              {% if not account_verification.id_uploaded %}
              <a href="{% url 'upload_id' %}" class="btn btn-sm btn-outline-primary">Upload ID</a>
              {% endif %}
            </div>
          </div>
          {% endif %}

          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
              </div>
            {% endfor %}
          {% endif %}

          <form method="post" novalidate>
            {% csrf_token %}
            
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">First Name *</label>
                {{ form.first_name }}
                {% if form.first_name.errors %}<div class="text-danger small">{{ form.first_name.errors.0 }}</div>{% endif %}
              </div>

              <div class="col-md-6">
                <label class="form-label">Last Name *</label>
                {{ form.last_name }}
                {% if form.last_name.errors %}<div class="text-danger small">{{ form.last_name.errors.0 }}</div>{% endif %}
              </div>

              <div class="col-md-12 mt-2">
                <label class="form-label">Phone Number *</label>
                {{ form.phone_number }}
                {% if form.phone_number.errors %}<div class="text-danger small">{{ form.phone_number.errors.0 }}</div>{% endif %}
                <div class="form-text">This will be used for payment notifications</div>
              </div>

              <div class="col-md-12 mt-2">
                <label class="form-label">Email *</label>
                {{ form.email }}
                {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors.0 }}</div>{% endif %}
                <div class="form-text">We'll send transaction updates to this email</div>
              </div>
            </div>

            <div class="mt-4 d-grid">
              <button class="btn btn-gold btn-lg" type="submit">Save Profile</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}
