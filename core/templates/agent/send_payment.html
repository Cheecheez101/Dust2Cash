{% extends 'base.html' %}
{% load static %}

{% block title %}Send Payment · Dust2Cash{% endblock %}
{% block body_class %}dashboard-body{% endblock %}

{% block content %}
<nav class="navbar dashboard-nav bg-white shadow-sm">
  <div class="nav-inner container">
    <a class="nav-identity" href="/">
      <img src="{% static 'img/dust2cashlogo.png' %}" alt="Dust2Cash logo">
      <div>
        <strong>Dust2Cash</strong>
        <div class="text-muted small">Agent console</div>
      </div>
    </a>
    <div class="nav-actions">
      {% if agent %}
      <span class="status-pill {% if agent.is_online %}success{% else %}warning{% endif %}">
        {% if agent.is_online %}Online{% else %}Offline{% endif %}
      </span>
      {% endif %}
      <a class="nav-pill nav-pill--ghost" href="{% url 'agent_portal' %}">Portal</a>
      <a class="nav-pill nav-pill--ghost" href="{% url 'agent_profile' %}">Profile</a>
      <a class="nav-pill nav-pill--ghost" href="{% url 'change_password' %}">Password</a>
      <a class="nav-pill nav-pill--danger" href="{% url 'logout' %}">Logout</a>
    </div>
  </div>
</nav>

<main class="dashboard-shell py-4">
  <section class="card-bleed mb-4">
    <div class="d-flex flex-column flex-lg-row justify-content-between gap-3 align-items-start">
      <div>
        <div class="hero-title">Send Payment to Client</div>
        <p class="hero-subtitle">Finalize the exchange by sending KSH {{ transaction.amount_to_receive }} via {{ transaction.get_payment_method_display }}.</p>
      </div>
      <a class="btn btn-outline-light" href="{% url 'agent_portal' %}">Back to Portal</a>
    </div>
  </section>

  <section class="dashboard-grid mb-4">
    <div class="stat-card">
      <div class="stat-label">Client</div>
      <div class="stat-value fs-4">{{ transaction.client }}</div>
      <small class="text-muted">Awaiting payout</small>
    </div>
    <div class="stat-card">
      <div class="stat-label">Method</div>
      <div class="stat-value fs-4">{{ transaction.get_payment_method_display }}</div>
      <small class="text-muted">{{ transaction.payment_phone }}</small>
    </div>
    <div class="stat-card">
      <div class="stat-label">Amount to send</div>
      <div class="stat-value fs-4">KSH {{ transaction.amount_to_receive }}</div>
      <small class="text-muted">Immediate delivery</small>
    </div>
    <div class="stat-card">
      <div class="stat-label">Crypto received</div>
      <div class="stat-value fs-4">{{ transaction.amount }} {{ transaction.get_currency_display }}</div>
      <small class="text-muted">Confirmed</small>
    </div>
  </section>

  <section class="dashboard-card">
    <div class="section-heading">
      <h5>Payment Details</h5>
    </div>
    <div class="row g-3 mb-4">
      <div class="col-md-6">
        <div class="p-3 bg-success-subtle rounded">
          <strong>Crypto Received</strong>
          <p class="mb-0">{{ transaction.amount }} {{ transaction.get_currency_display }}</p>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 bg-light rounded">
          <strong>Client</strong>
          <p class="mb-0">{{ transaction.client }}</p>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 bg-light rounded">
          <strong>Payment Method</strong>
          <p class="mb-0">{{ transaction.get_payment_method_display }}</p>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 bg-light rounded">
          <strong>Phone Number</strong>
          <p class="mb-0">{{ transaction.payment_phone }}</p>
        </div>
      </div>
    </div>

    <div class="alert alert-info mb-4">
      <strong>Instructions:</strong>
      <ol class="mb-0 mt-2">
        <li>Send <strong>KSH {{ transaction.amount_to_receive }}</strong> via {{ transaction.get_payment_method_display }}.</li>
        <li>Use phone number: <strong>{{ transaction.payment_phone }}</strong>.</li>
        <li>Verify the transfer succeeded.</li>
        <li>Mark payment as sent below.</li>
      </ol>
    </div>

    <form method="post" class="d-grid gap-3">
      {% csrf_token %}
      <div class="alert alert-warning">
        Only confirm after completing the payout; this notifies the client immediately.
      </div>
      <div class="d-grid gap-2">
        <button class="btn btn-success" type="submit">✓ Confirm Payment Sent</button>
        <a href="{% url 'agent_portal' %}" class="btn btn-outline-secondary">Cancel</a>
      </div>
    </form>
  </section>
</main>
{% endblock %}
